{"version":2,"kind":"Article","sha256":"22d6c931dc7e397fa18ccc53e2665e9be2b6c84e4f3312dcc4ca66e42f7f05a9","slug":"index","location":"/Content/project.md","dependencies":[{"url":"/maincode-first-run","label":"loss_first_run","kind":"Notebook","slug":"maincode-first-run","location":"/Notebooks/Maincode_first_run.ipynb","title":"Mainrun notebook - First run"},{"url":"/maincode-step-one","label":"step_one_words","kind":"Notebook","slug":"maincode-step-one","location":"/Notebooks/Maincode_Step_one.ipynb"},{"url":"/maincode-step-two","label":"output_step_two_token_10","kind":"Notebook","slug":"maincode-step-two","location":"/Notebooks/Maincode_Step_two.ipynb"}],"frontmatter":{"title":"Introduction","content_includes_title":true,"authors":[{"id":"Luuk Fröling","name":"Luuk Fröling"}],"date":"2025-11-17","github":"https://github.com/luukfroling/BEP","exports":[{"format":"md","filename":"project.md","url":"/project-da822b72d1dfd03ae3e3849d0f2a15c3.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"flOg3BYi5f"}],"key":"wSQ73F4Pq5"},{"type":"heading","depth":1,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Introduction","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xRHgfQCYSD"}],"identifier":"introduction","label":"Introduction","html_id":"introduction","implicit":true,"key":"PDKDl6F7yq"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Running train.py using my laptop would (according to my calculations) have taken about 3 days. Instead, I will be using google colab to run the notebook files, which I then download and place in the Notebooks folder of this project. All notebooks can be accessed under ‘supporting documents’.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"UUDj9hXNgY"}],"key":"HVil8UUM4T"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"This website is build using ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"T4svz08JpD"},{"type":"link","url":"https://mystmd.org/","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Myst","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"QZ5Ks54obl"}],"urlSource":"https://mystmd.org/","key":"pA4e01amxv"},{"type":"text","value":", which lets me write about changes I made to ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"gwzhxkGfAt"},{"type":"inlineCode","value":"train.py","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"u2NsPTrPFJ"},{"type":"text","value":" in a structured way, combining code-cell outputs with markdown text. For any figure, a ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"d1Wzr1wjuC"},{"type":"inlineCode","value":"source : ...","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"mflQCuIsf4"},{"type":"text","value":" button will appear in the top right corner, clicking it will jump directly to the original notebook file.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"KQ3aUnUnuK"}],"key":"BvqzTlZfJ0"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"The goal of this project is:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Hzh8PY5gQG"}],"key":"sx65bqVGt9"},{"type":"blockquote","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Your task is to analyze and improve the training run of a small GPT-2 style model. The code is designed to train on a Hacker News headline dataset. Your goal is to minimize the validation loss as low as possible within 7 epochs. The baseline to beat is a validation loss of 1.754.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"Ilf5dSisbK"}],"key":"K4YArkHmpM"}],"key":"I5luxdjh0g"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Where I aim to:","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"ZYKf1qXfHa"}],"key":"WZ38VEGdQK"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":14,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Minimise the validation loss.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"U6cm3MeGDY"}],"key":"FeLsTLwAnV"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Understand how well the model performs.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"fECrpkpsI1"}],"key":"U3P2sukt8t"}],"key":"MY0MtMdvff"},{"type":"heading","depth":1,"position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Initial run","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"jlf8VvNgOY"}],"identifier":"initial-run","label":"Initial run","html_id":"initial-run","implicit":true,"key":"lKTeketj95"},{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"The first step is to run the original train.py file as provided on the GitHub page.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"v0a4SaDJbc"}],"key":"yLcGK4wQPE"},{"type":"container","kind":"figure","children":[{"type":"output","id":"R1-cUeQgVj5dFXzGs803t","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"35bc7d27cd67bfb426903dad2f7d56ba","path":"/35bc7d27cd67bfb426903dad2f7d56ba.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}}],"key":"caCFdlSSSD"}],"label":"label_loss_first_run","identifier":"label_loss_first_run","enumerator":"1","html_id":"label-loss-first-run","source":{"url":"/maincode-first-run","label":"loss_first_run","kind":"Notebook","slug":"maincode-first-run","location":"/Notebooks/Maincode_first_run.ipynb","title":"Mainrun notebook - First run"},"key":"ADmEQbdLhX"},{"type":"paragraph","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"Figure ","key":"BGKOD0qI8D"},{"type":"text","value":"1","key":"nXr6ZQkUvE"}],"identifier":"label_loss_first_run","label":"label_loss_first_run","kind":"figure","template":"Figure %s","enumerator":"1","resolved":true,"html_id":"label-loss-first-run","key":"HZF96qBaSS"},{"type":"text","value":" shows how the loss decreases as training progresses, converging to ","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"O03PsG2bCa"},{"type":"inlineCode","value":"loss=1.753273","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"PVDoQ7ZtV2"},{"type":"text","value":" after 7 epochs. We can also have a look at an example of the output provided by the model. For this, I’ll look at ","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"rK6b9Zs23q"},{"type":"inlineCode","value":"batch = 0","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"Ia2GqV5pl8"},{"type":"text","value":" and ","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"HY2SjVuWHN"},{"type":"inlineCode","value":"time = 10","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"NpJoPwbutk"},{"type":"text","value":" within the ","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"pk082ZGlHP"},{"type":"inlineCode","value":"evaluate_visualise","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"WgLIt9DZ8j"},{"type":"text","value":" function. The decoded input to the model is:","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"EI3qNmDrKW"}],"key":"susEryCrR7"},{"type":"blockquote","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"inlineCode","value":"Motorola Xoom commercial reminiscent of Apple's","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"VCIquzORMc"}],"key":"GreVqWTHr7"}],"key":"K7x5L6GWKx"},{"type":"paragraph","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"text","value":"The model’s top-10 predicted next tokens are shown in ","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"oKamoQ3xks"},{"type":"crossReference","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"text","value":"Figure ","key":"RviaObWyyj"},{"type":"text","value":"2","key":"V5JIaNiUmn"}],"identifier":"label_token_frequency_first_run","label":"label_token_frequency_first_run","kind":"figure","template":"Figure %s","enumerator":"2","resolved":true,"html_id":"label-token-frequency-first-run","key":"kZpKdpF0F8"},{"type":"text","value":".","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"TNP9yiUXuj"}],"key":"BHBhND85AQ"},{"type":"container","kind":"figure","children":[{"type":"output","id":"kQr9Dx_z6ze60BQYGsf4O","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"2d7caf7c249be1fbc8e7131756ef3219","path":"/2d7caf7c249be1fbc8e7131756ef3219.png"},"text/plain":{"content":"<Figure size 1200x500 with 1 Axes>","content_type":"text/plain"}}}],"key":"SALqdv3Ilw"}],"label":"label_token_frequency_first_run","identifier":"label_token_frequency_first_run","enumerator":"2","html_id":"label-token-frequency-first-run","source":{"url":"/maincode-first-run","label":"token_frequency_first_run","kind":"Notebook","slug":"maincode-first-run","location":"/Notebooks/Maincode_first_run.ipynb","title":"Mainrun notebook - First run"},"key":"zxspEXYifu"},{"type":"paragraph","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"As seen in the figure, the model incorrectly predicts ","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"upMakJ04cY"},{"type":"inlineCode","value":"<eos>","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"WLqKEoBWP3"},{"type":"text","value":" as the most probable token. In fact, the model predicts this token for every input I checked.","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"PLMAw8oo0V"}],"key":"UNWdefVIWs"},{"type":"container","kind":"figure","children":[{"type":"output","id":"KGLJm0AsyNfJVUiAQf4xN","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"95714af3631914dbdd5c918d5cc88961","path":"/95714af3631914dbdd5c918d5cc88961.png"},"text/plain":{"content":"<Figure size 1400x600 with 1 Axes>","content_type":"text/plain"}}}],"key":"oef4D7aMVO"}],"label":"label_token_frequency_input","identifier":"label_token_frequency_input","enumerator":"3","html_id":"label-token-frequency-input","source":{"url":"/maincode-first-run","label":"token_frequency_input","kind":"Notebook","slug":"maincode-first-run","location":"/Notebooks/Maincode_first_run.ipynb","title":"Mainrun notebook - First run"},"key":"Q2ZURxifFC"},{"type":"paragraph","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"text","value":"Figure ","key":"XjfgeFVTKH"},{"type":"text","value":"3","key":"MJx2xnASFV"}],"identifier":"label_token_frequency_input","label":"label_token_frequency_input","kind":"figure","template":"Figure %s","enumerator":"3","resolved":true,"html_id":"label-token-frequency-input","key":"JVcfgeZU2S"},{"type":"text","value":" displays the most frequently used words in the input data. This distribution matches the model’s predictions in ","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"SeLEYRrZ68"},{"type":"crossReference","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"text","value":"Figure ","key":"k7yUV36I6d"},{"type":"text","value":"2","key":"ZHyNe9af33"}],"identifier":"label_token_frequency_first_run","label":"label_token_frequency_first_run","kind":"figure","template":"Figure %s","enumerator":"2","resolved":true,"html_id":"label-token-frequency-first-run","key":"f2Hxg71yAA"},{"type":"text","value":", which tells us the model is not making the predictions based on context, but rather based on statistics (clever, but now what we are looking for). The aim now is not only to improve the validation loss, but also to adjust the model so it produces more sensible next-token predictions rather than defaulting to ","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"Uq0nknSlGJ"},{"type":"inlineCode","value":"<eos>","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"gaB6VjNPdt"},{"type":"text","value":".","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"FysPGkZrN1"}],"key":"x17qxjvyOg"},{"type":"heading","depth":1,"position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"text","value":"Step one - AdamW Optimiser","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"AeqJGYDUZP"}],"identifier":"step-one-adamw-optimiser","label":"Step one - AdamW Optimiser","html_id":"step-one-adamw-optimiser","implicit":true,"key":"VaE6l2rQaZ"},{"type":"paragraph","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"The original model uses an SGD optimiser, which is not ideal for training attention-based architectures. I switched to AdamW instead, which is the optimiser typically used for modern transformer and LLM training.","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"XuVizbZpA5"}],"key":"PW9Zb7itz7"},{"type":"code","lang":"python","value":"# Add different optimiser, which is better suited for transformer models\ndef get_optimizer(model, args):\n    # Add AdamW as an optimiser\n    return torch.optim.AdamW(model.parameters(), lr=args.lr, weight_decay=args.weight_decay, betas=args.betas)","position":{"start":{"line":48,"column":1},"end":{"line":53,"column":1}},"key":"J8OIQrKJxJ"},{"type":"paragraph","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"text","value":"I added a separate ","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"J3gzCxHtsU"},{"type":"inlineCode","value":"get_optimizer","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"tjmMFStqo4"},{"type":"text","value":" function so the change is easy to spot at the top of the code cell. I also reduced the learning rate and added explicit beta values for AdamW:","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"X9n7qNlgX0"}],"key":"X2h06sZHEZ"},{"type":"code","lang":"python","value":"n_layer: int = 6\nn_head: int = 8\nd_model: int = 512\ndropout: float = 0.1\nlr = 5e-4                   #lr: float = 6e-3, \nweight_decay: float = 0.0\nevals_per_epoch: int = 3\nbetas = (0.9, 0.95)         # Added betas for AdamW","position":{"start":{"line":57,"column":1},"end":{"line":66,"column":1}},"key":"qlgnDuOrnt"},{"type":"paragraph","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"Running the model with these changes resulted in a validation loss of 1.32, a noticeable improvement over the original program. More importantly, the model produces far more reasonable next-token suggestions. For example, when given the input:","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"t7FpxdGsMP"}],"key":"EHOGjQIibf"},{"type":"blockquote","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"children":[{"type":"text","value":"Motorola Xoom commercial reminiscent of Apple’s","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"TvK8FprBG6"}],"key":"Gc0DYf4rAy"}],"key":"pqMaYrT6i4"},{"type":"paragraph","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"children":[{"type":"text","value":"the predictions look much better, as shown in ","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"key":"gV7APaEPid"},{"type":"crossReference","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"children":[{"type":"text","value":"Figure ","key":"rojuZAHeBL"},{"type":"text","value":"4","key":"r91h7wWOQh"}],"identifier":"label_step_one_words","label":"label_step_one_words","kind":"figure","template":"Figure %s","enumerator":"4","resolved":true,"html_id":"label-step-one-words","key":"lVfBDsr3eo"}],"key":"YRGcvKrSMJ"},{"type":"container","kind":"figure","children":[{"type":"output","id":"lanWxxCCJq6w71WNJQ_TK","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"caf20c53206bb6be0aa80d9e85b054d4","path":"/caf20c53206bb6be0aa80d9e85b054d4.png"},"text/plain":{"content":"<Figure size 1200x500 with 1 Axes>","content_type":"text/plain"}}}],"key":"rT1hYJXAyO"}],"label":"label_step_one_words","identifier":"label_step_one_words","enumerator":"4","html_id":"label-step-one-words","source":{"url":"/maincode-step-one","label":"step_one_words","kind":"Notebook","slug":"maincode-step-one","location":"/Notebooks/Maincode_Step_one.ipynb"},"key":"sCNw0Huuav"},{"type":"paragraph","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"children":[{"type":"text","value":"Here, the top prediction is “new”, which fits naturally after the given fragment.","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"sUOxlp0SBV"}],"key":"uh7uhoaZpL"},{"type":"heading","depth":1,"position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"text","value":"Step two - Positional context/increased vocab","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"FnosP2pacI"}],"identifier":"step-two-positional-context-increased-vocab","label":"Step two - Positional context/increased vocab","html_id":"step-two-positional-context-increased-vocab","implicit":true,"key":"w6I5nHRgqN"},{"type":"paragraph","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"children":[{"type":"text","value":"I noticed that each training sample’s context often contains multiple titles in a row, but earlier titles offer no useful information for predicting later ones. For example, the first batch may include an input such as:","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"key":"LY9enjLPFQ"}],"key":"jPfFQ6rTwW"},{"type":"blockquote","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"children":[{"type":"inlineCode","value":"Motorola Xoom commercial reminiscent of Apple's infamous jab at IBM<eos> OpenSSH Key Shielding<eos> Contextual Word Representations: A Contextual Introduction (2020)<eos> Windows 8 Should Be Free<eos> GNOME Developers ","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"ih7HtKv8gA"}],"key":"rjAZG74gHx"}],"key":"ZIwtUzIAwC"},{"type":"paragraph","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"children":[{"type":"text","value":"The next word after “GNOME Developers” has nothing to do with the earlier titles. Positional information should help the model focus on the current sentence and ignore older ones. I have added ","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"xemjuGOVVB"},{"type":"link","url":"https://towardsdatascience.com/positional-embeddings-in-transformers-a-math-guide-to-rope-alibi/","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"children":[{"type":"text","value":"Rotary Position Embedding (RoPE) ","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"TKcTLve3r0"}],"urlSource":"https://towardsdatascience.com/positional-embeddings-in-transformers-a-math-guide-to-rope-alibi/","key":"Tfr2CjbIHm"},{"type":"text","value":", wwhich I was unfamiliar with before the project but found straightforward to integrate.","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"fv189JAAiA"}],"key":"qj62F6Lg7A"},{"type":"paragraph","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"children":[{"type":"text","value":"In addition, I increased the tokenizer vocab size and added RSMNorm. Tasks with many unique tokens (technical words, product names, company names, and acronyms) tend to benefit from a larger vocabulary because it reduces over-fragmentation during BPE tokenization.","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"yVDEh1Srva"}],"key":"T95hSALgoF"},{"type":"paragraph","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"children":[{"type":"text","value":"With these changes combined, I was able to bring the validation loss down to 1.25. After training, the output distribution for the same input as ","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"key":"g7rO85JIWH"},{"type":"crossReference","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"children":[{"type":"text","value":"Figure ","key":"BR2Cxs7jFc"},{"type":"text","value":"2","key":"wbqoVD3sYi"}],"identifier":"label_token_frequency_first_run","label":"label_token_frequency_first_run","kind":"figure","template":"Figure %s","enumerator":"2","resolved":true,"html_id":"label-token-frequency-first-run","key":"mAsvnuoZpO"},{"type":"text","value":" is shown below.","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"key":"mAySasHGft"}],"key":"zIScwIcTW8"},{"type":"container","kind":"figure","children":[{"type":"output","id":"uXZxK7aZ4O2RTu06y-Iv7","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1200x500 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"f634fbbc627a4dc7b436ba20ab65091d","path":"/f634fbbc627a4dc7b436ba20ab65091d.png"}}}],"key":"zPzhTBNwhW"}],"label":"label_output_step_two_token_10","identifier":"label_output_step_two_token_10","enumerator":"5","html_id":"label-output-step-two-token-10","source":{"url":"/maincode-step-two","label":"output_step_two_token_10","kind":"Notebook","slug":"maincode-step-two","location":"/Notebooks/Maincode_Step_two.ipynb"},"key":"D4eYDVrkGp"},{"type":"paragraph","position":{"start":{"line":97,"column":1},"end":{"line":97,"column":1}},"children":[{"type":"text","value":"Given the sentence so far (","position":{"start":{"line":97,"column":1},"end":{"line":97,"column":1}},"key":"yGteBG3jZq"},{"type":"inlineCode","value":"Motorola Xoom commercial reminiscent of Apple's","position":{"start":{"line":97,"column":1},"end":{"line":97,"column":1}},"key":"hNP0UaZBWq"},{"type":"text","value":"), the top two predictions (“new” and “first”) are both reasonable continuations.","position":{"start":{"line":97,"column":1},"end":{"line":97,"column":1}},"key":"r3IxgIhGoL"}],"key":"NlE4ghYwZb"},{"type":"paragraph","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"Another interesting case is to look at a longer string. By setting ","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"XYGQgpfaFc"},{"type":"inlineMath","value":"b=0 and t=80","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi><mo>=</mo><mn>0</mn><mi>a</mi><mi>n</mi><mi>d</mi><mi>t</mi><mo>=</mo><mn>80</mn></mrow><annotation encoding=\"application/x-tex\">b=0 and t=80</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord\">0</span><span class=\"mord mathnormal\">an</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">80</span></span></span></span>","key":"vRHmHP9zWH"},{"type":"text","value":" in the evaluate_visualise function, we get","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"BuBUtyaiMf"}],"key":"qtrtSeTsPp"},{"type":"blockquote","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"children":[{"type":"inlineCode","value":"Motorola Xoom commercial reminiscent of Apple's infamous jab at IBM<eos> OpenSSH Key Shielding<eos> Contextual Word Representations: A Contextual Introduction (2020)<eos> Windows 8 Should Be Free<eos> GNOME Developers Lay Out Plans for GNOME OS<eos> HTML/CSS/JS Art Hacks<eos> Major Electrical Outtage at The Planet Data Center<eos> South Africa’s Umhlanga Rocks may attract investors<eos>","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"key":"iDxkSTLfb7"}],"key":"zeJmM3g8DI"}],"key":"jKwYqPYRwB"},{"type":"paragraph","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"children":[{"type":"text","value":"At this point, the model must decide how to start a brand-new sentence.","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"RNdSoieOuw"}],"key":"aOwha8Z1zP"},{"type":"container","kind":"figure","children":[{"type":"output","id":"NZcOVDS5lh59d0TSj4I1K","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"bde12aad412e5e105dde5df45c32c2eb","path":"/bde12aad412e5e105dde5df45c32c2eb.png"},"text/plain":{"content":"<Figure size 1200x500 with 1 Axes>","content_type":"text/plain"}}}],"key":"cfyY0Zgy53"}],"label":"label_token_predictions_two","identifier":"label_token_predictions_two","enumerator":"6","html_id":"label-token-predictions-two","source":{"url":"/maincode-step-two","label":"token_predictions_two","kind":"Notebook","slug":"maincode-step-two","location":"/Notebooks/Maincode_Step_two.ipynb"},"key":"zZBBTz8xML"},{"type":"paragraph","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"children":[{"type":"text","value":"Figure ","key":"nRWLf49GQ4"},{"type":"text","value":"6","key":"hWfiHKRulr"}],"identifier":"label_token_predictions_two","label":"label_token_predictions_two","kind":"figure","template":"Figure %s","enumerator":"6","resolved":true,"html_id":"label-token-predictions-two","key":"Q2f4Vr81Pm"},{"type":"text","value":" shows the predicted probability distribution. For the start of a fresh sentence, any of the top-ten tokens would make sense.","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"Fdf3vSmGhn"}],"key":"XTLT6d36cq"},{"type":"paragraph","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"children":[{"type":"text","value":"This example also highlights the biggest issue I’ve encountered so far: no amount of tuning can help the model guess the next word (“Snapchat”) without additional context. The model has no information about the underlying article or subject matter, only the previous titles. It simply doesn’t have the necessary cues.","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"w0PyYLdedJ"}],"key":"Y8ReWm8Rk0"},{"type":"heading","depth":1,"position":{"start":{"line":113,"column":1},"end":{"line":113,"column":1}},"children":[{"type":"text","value":"Concluding thoughts","position":{"start":{"line":113,"column":1},"end":{"line":113,"column":1}},"key":"mL2G5Uu2Ne"}],"identifier":"concluding-thoughts","label":"Concluding thoughts","html_id":"concluding-thoughts","implicit":true,"key":"gmU5HyW2Op"},{"type":"paragraph","position":{"start":{"line":115,"column":1},"end":{"line":115,"column":1}},"children":[{"type":"text","value":"With a final validation loss of 1.25, I feel like I have reched the 80/20 point. Tweaking the optimiser, vocab size and implementing RoPe accounted for roughly 20% of the effort but delivered about 80% of the achievable gains. As shown in step 2, the model already performs well when we consider that it lacks important context, so other optimisations (like changing the architecture) would most likely result in little improvement to the loss.","position":{"start":{"line":115,"column":1},"end":{"line":115,"column":1}},"key":"tVdOaJ7VCU"}],"key":"AoyGH0Js8G"},{"type":"paragraph","position":{"start":{"line":117,"column":1},"end":{"line":117,"column":1}},"children":[{"type":"text","value":"In line with Maincode’s mission of building solutions that stand the test of time, I would instead recommend  focusing on providing more context rather than continuing to tune the existing architecture. One promising direction would be to include the article text itself, allowing the model to extract keywords (e.g., company names, locations, products) and general themes before predicting the title.","position":{"start":{"line":117,"column":1},"end":{"line":117,"column":1}},"key":"qXq4smHAvU"}],"key":"oADQfWOFC5"},{"type":"paragraph","position":{"start":{"line":119,"column":1},"end":{"line":119,"column":1}},"children":[{"type":"text","value":"This additional information would address the core limitation revealed in the examples: the model often lacks the semantic clues needed to make the “correct” next-token prediction, because that information is nowhere in its current input. Adding this additional context will most likely improve the loss significantly more than small optimisations inside the current pipeline.","position":{"start":{"line":119,"column":1},"end":{"line":119,"column":1}},"key":"gfgxEL9X5U"}],"key":"KT689PCWoV"}],"key":"ah97H87pGT"}],"key":"kQgC5k90bz"},"references":{"cite":{"order":[],"data":{}}}}